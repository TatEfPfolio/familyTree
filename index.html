<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Family Tree (D3)</title>
  <style>
    body { margin: 0; font-family: sans-serif; }
    svg { width: 100vw; height: 100vh; }
    .node circle {
      fill: #69b3a2;
    }
    .node text {
      font: 14px sans-serif;
      text-anchor: middle;
      fill: #333;
    }
    .link {
      fill: none;
      stroke: #ccc;
      stroke-width: 2px;
    }
  </style>
</head>
<body>
  <svg></svg>

  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script>
    fetch("treeData.json")
      .then(res => res.json())
      .then(data => {
        // Build a map of all people
        const people = Object.fromEntries(data.map(p => [p.id, { ...p, children: [] }]));

        // Link children to parents
        data.forEach(person => {
          (person.parents || []).forEach(pid => {
            if (people[pid]) {
              people[pid].children.push(people[person.id]);
            }
          });
        });

        // Find root(s) - people with no parents
        const roots = data.filter(p => !p.parents || p.parents.length === 0);
        if (roots.length === 0) {
          alert("No root found in data (nobody without parents)");
          return;
        }

        const root = d3.hierarchy(people[roots[0].id]);

        const width = window.innerWidth;
        const height = window.innerHeight;

        const tree = d3.tree().size([width - 100, height - 100]);
        tree(root);

        const svg = d3.select("svg")
          .append("g")
          .attr("transform", "translate(50,50)");

        svg.selectAll(".link")
          .data(root.links())
          .join("path")
          .attr("class", "link")
          .attr("d", d3.linkVertical()
            .x(d => d.x)
            .y(d => d.y)
          );

        const node = svg.selectAll(".node")
          .data(root.descendants())
          .join("g")
          .attr("class", "node")
          .attr("transform", d => `translate(${d.x},${d.y})`);

        node.append("circle").attr("r", 6);

        node.append("text")
          .attr("dy", -10)
          .text(d => `${d.data.full_name} (${d.data.birth_year || "?"}â€“${d.data.death_year || "?"})`);
      });
  </script>
</body>
</html>
